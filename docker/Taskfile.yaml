version: "3"

vars:
  COMPOSE_CMD: '{{.COMPOSE_CMD | default "docker-compose"}}'
  VOLUME_RM_CMD: '{{.VOLUME_RM_CMD | default "docker volume rm"}}'

tasks:
  default:
    cmds:
      - task: run-commons-min

  run-commons-min:
    desc: "Run docker required services (postgres, kafka)"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons-min.yaml up -d"
  stop-commons-min:
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons-min.yaml down"

  run-commons:
    desc: "Run docker required services (postgres, kafka, tracing, monitoring, etc.)"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons.yaml up -d"
  stop-commons:
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons.yaml down"

  stop-java-min:
    desc: "Stop docker java services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons-min.yaml -f docker-compose-java.yaml down jvm-orders-grpc-service jvm-payments-grpc-service jvm-reserve-grpc-service"
  run-java-min:
    desc: "Run docker java reactive services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons-min.yaml -f docker-compose-java.yaml up -d"

  stop-java:
    desc: "Stop docker java services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons.yaml -f docker-compose-java.yaml down jvm-orders-grpc-service jvm-payments-grpc-service jvm-reserve-grpc-service"
  run-java:
    desc: "Run docker java reactive services"
    env:
      TRACING_ENABLED: true
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons.yaml -f docker-compose-java.yaml up -d"

  stop-java-sync:
    desc: "Stop docker java services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons.yaml -f docker-compose-java-sync.yaml down jvm-orders-grpc-service-sync jvm-payments-grpc-service-sync jvm-reserve-grpc-service-sync"
  run-java-sync:
    desc: "Run docker java sync services"
    env:
      TRACING_ENABLED: true
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons.yaml -f docker-compose-java-sync.yaml up -d"

  stop-java-sync-min:
    desc: "Stop docker java services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons-min.yaml -f docker-compose-java-sync.yaml down jvm-orders-grpc-service-sync jvm-payments-grpc-service-sync jvm-reserve-grpc-service-sync"
  run-java-sync-min:
    desc: "Run docker java sync services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons-min.yaml -f docker-compose-java-sync.yaml up -d"

  stop-go-min:
    desc: "Stop docker go services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons-min.yaml -f docker-compose-go.yaml down go-orders-grpc-service go-payments-grpc-service go-reserve-grpc-service"
  run-go-min:
    desc: "Run docker go services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons-min.yaml -f docker-compose-go.yaml up -d"

  stop-go:
    desc: "Stop docker go services"
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons.yaml -f docker-compose-go.yaml down go-orders-grpc-service go-payments-grpc-service go-reserve-grpc-service"
  run-go:
    desc: "Run docker go services"
    env:
      TRACING_ENABLED: true
    cmds:
      - "{{.COMPOSE_CMD}} -f docker-compose-commons.yaml -f docker-compose-go.yaml up -d"

  recreate-requirements:
    desc: "Clean docker required services and restart"
    cmds:
      - |
        {{.COMPOSE_CMD}} down
        {{.VOLUME_RM_CMD}} distributed-transactions-practice_db-data
      - task: run-commons-min
